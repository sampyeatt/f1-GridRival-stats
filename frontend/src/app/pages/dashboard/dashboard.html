<div class="py-6">
  <div class="flex justify-center">
    <p-select [options]="this.races" [(ngModel)]="selectedRace" (onChange)=filterResults() optionLabel="meeting_name" placeholder="Select Race" class="w-full md:w-100 px-1" animate="enter-animation"/>
  </div>

  <p-tabs value="driver">
    <div class="flex justify-center py-6">
      <p-tablist>
        <p-tab value="driver">Drivers</p-tab>
        <p-tab value="team">Teams</p-tab>
      </p-tablist>
    </div>
    <p-tabpanels>
      <p-tabpanel value="driver">
        @if (this.selectedResult) {
          <div class="flex justify-center py-6">
            <p-table [value]="this.selectedResult" scrollable dataKey="driverId" [expandedRowKeys]="expandedRows" (onRowExpand)="onRowExpandDriver($event)" (onRowCollapse)="onRowCollapseDriver($event)" rowExpandMode="single" [tableStyle]="{ 'max-width': '75rem' }">
              <ng-template #header pTemplate="header">
                <tr>
                  <th></th>
                  <th pSortableColumn="driver.driverName">
                    DriverId
                    <p-sortIcon field="driver.driverName"/>
                  </th>
                  <th pSortableColumn="cost">
                    Cost
                    <p-sortIcon field="cost"/>
                  </th>
                  <th pSortableColumn="points">
                    Points
                    <p-sortIcon field="points"/>
                  </th>
                  <th pSortableColumn="positionsForMoney">
                    Pos To Gain $
                    <p-sortIcon field="positionsForMoney"/>
                  </th>
                  <th pSortableColumn="easeToGainPoints">
                    Ease to Gain
                    <p-sortIcon field="easeToGainPoints"/>
                  </th>
                </tr>
              </ng-template>
              <ng-template #body let-result let-expanded="expanded" pTemplate="body">
                <tr>
                  <td>
                    @if (!expanded) {
                      <p-button type="button" pRipple [pRowToggler]="result" [text]="true" rounded class="pi pi-chevron-right"/>
                    }
                    @if (expanded) {
                      <p-button type="button" pRipple [pRowToggler]="result" [text]="true" rounded class="pi pi-chevron-down"/>
                    }
                  </td>
                  <td>{{ result.driver.driverName }}</td>
                  <td>{{ result.cost }}</td>
                  <td>{{ result.points }}</td>
                  <td>
                    {{ result.positionsForMoney }}
                  </td>
                  <td>
                    <p-badge [value]="result.easeToGainPoints" [ngStyle]="{backgroundColor: `${posSev( result)}`}"/>
                  </td>
                </tr>
              </ng-template>
              <ng-template #expandedrow pTemplate="rowexpansion">
                <tr>
                  <td colspan="7">
                    <p-chart type="line" [data]="this.data" [options]="this.options" width="70rem" height="20rem"/>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        }
      </p-tabpanel>
      <p-tabpanel value="team">
        <div class="flex justify-center py-6">
          @if (this.selectedTeamResult) {
            <p-table scrollable [value]="this.selectedTeamResult" dataKey="teamId" [expandedRowKeys]="expandedRows" (onRowExpand)="onRowExpandTeam($event)" (onRowCollapse)="onRowCollapseTeam($event)" rowExpandMode="single" [tableStyle]="{ 'max-width': '75rem' }">
              <ng-template #header pTemplate="header">
                <tr>
                  <th></th>
                  <th pSortableColumn="criverId">
                    TeamId
                    <p-sortIcon field="driverId"/>
                  </th>
                  <th pSortableColumn="cost">
                    Cost
                    <p-sortIcon field="cost"/>
                  </th>
                  <th pSortableColumn="points">
                    Points
                    <p-sortIcon field="points"/>
                  </th>
                  <th pSortableColumn="positionsForMoney">
                    Positions To Gain $
                    <p-sortIcon field="positionsForMoney"/>
                  </th>
                  <th pSortableColumn="easeToGainPoints">
                    Ease to Gain
                    <p-sortIcon field="easeToGainPoints"/>
                  </th>
                </tr>
              </ng-template>
              <ng-template #body let-teamresult let-expanded="expanded" pTemplate="body">
                <tr>
                  <td>
                    @if (!expanded) {
                      <p-button type="button" pRipple [pRowToggler]="teamresult" [text]="true" rounded class="pi pi-chevron-right"/>
                    }
                    @if (expanded) {
                      <p-button type="button" pRipple [pRowToggler]="teamresult" [text]="true" rounded class="pi pi-chevron-down"/>
                    }
                  </td>
                  <td>{{ teamresult.team.teamName }}</td>
                  <td>{{ teamresult.cost }}</td>
                  <td>{{ teamresult.points }}</td>
                  <td>
                    {{ teamresult.positionsForMoney }}
                  </td>
                  <td>
                    <p-badge [value]="teamresult.easeToGainPoints" [ngStyle]="{backgroundColor: `${posSev( teamresult)}`}"/>
                  </td>
                </tr>
              </ng-template>
              <ng-template #expandedrow pTemplate="rowexpansion">
                <tr>
                  <td colspan="7">
                    <p-chart type="line" [data]="this.data" [options]="this.options" width="70rem" height="20rem"/>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          }
        </div>
      </p-tabpanel>
    </p-tabpanels>

  </p-tabs>

</div>

